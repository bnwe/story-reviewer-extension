# Story 2.1: Prompt Management UI

## Status
Draft

## Story
**As a** Product Owner,
**I want** to customize AI feedback prompts through an intuitive interface in the extension options page,
**so that** I can tailor feedback to my team's specific standards, processes, and requirements.

## Acceptance Criteria
1. Add prompt customization interface to the existing options page with default templates for each AI provider
2. Provide edit capabilities with syntax highlighting and validation for prompt templates
3. Include preview functionality that shows how prompts will appear before sending to AI
4. Allow users to reset prompts to default templates at any time
5. Support provider-specific prompt customization (OpenAI, Anthropic, Custom endpoints)

## Tasks / Subtasks
- [ ] Extend existing options page UI with prompt management section (AC: 1)
  - [ ] Add new "Custom Prompts" section to options.html below API settings
  - [ ] Create tabbed interface for different AI providers (OpenAI, Anthropic, Custom)
  - [ ] Implement provider-specific prompt template defaults
  - [ ] Add visual separation between API settings and prompt management
- [ ] Implement prompt editing interface (AC: 2)
  - [ ] Add textarea with syntax highlighting for prompt editing
  - [ ] Implement real-time character count and validation feedback
  - [ ] Add template variable reference guide ({{storyContent}}, {{userRequirements}}, etc.)
  - [ ] Create save/cancel buttons with unsaved changes warning
- [ ] Build preview functionality (AC: 3)
  - [ ] Add "Preview Prompt" button that shows final prompt with sample data
  - [ ] Create modal dialog for prompt preview display
  - [ ] Include variable substitution preview with sample story content
  - [ ] Add copy-to-clipboard functionality for previewed prompts
- [ ] Implement reset functionality (AC: 4)
  - [ ] Add "Reset to Default" button for each provider
  - [ ] Implement confirmation dialog for reset action
  - [ ] Restore default prompt templates from configuration
  - [ ] Update UI to reflect reset changes immediately
- [ ] Integrate with existing provider selection system (AC: 5)
  - [ ] Connect prompt management to existing provider dropdown
  - [ ] Ensure prompt changes are saved per provider
  - [ ] Update storage schema to include custom prompts per provider
  - [ ] Maintain backward compatibility with existing settings
- [ ] Add comprehensive testing (AC: 1-5)
  - [ ] Unit tests for prompt template management
  - [ ] Unit tests for preview functionality
  - [ ] Unit tests for reset to defaults
  - [ ] Integration tests with existing options page
  - [ ] Manual testing across all supported providers

## Dev Notes

### Previous Story Insights
[Source: docs/stories/1.2.provide-feedback.md#dev-agent-record]
- Existing options page infrastructure at `/options/` with options.html, options.css, options.js
- Current OptionsManager class handles API provider selection (OpenAI, Anthropic, Custom)
- Storage system uses chrome.storage.local with settings schema including apiProvider, apiKey, customEndpoint
- Auto-save functionality already implemented for settings changes
- Provider-specific UI already exists with custom endpoint handling for "custom" provider

### Technology Stack
[Source: docs/technical/technology-stack.md]
- **Language**: JavaScript (vanilla, no frameworks)
- **UI Library**: None (builds on existing options page CSS/HTML)
- **Styling**: CSS for prompt management interface
- **Storage**: Browser extension storage API (chrome.storage.local)

### Existing Options Page Structure
[Source: Previous implementation analysis]
- `/options/options.html` - Main options page structure
- `/options/options.css` - Existing styling to extend
- `/options/options.js` - OptionsManager class to enhance
- Current sections: API Provider selection, API Key input, Custom Endpoint (conditional)
- Auto-save functionality, connection testing, settings persistence

### Storage Schema Extension
[Source: docs/stories/1.2.provide-feedback.md#dev-notes]
Current storage schema needs extension:
```javascript
// Current schema
{
  apiProvider: 'openai|anthropic|custom',
  apiKey: 'string',
  customEndpoint: 'string'
}

// Extended schema needed
{
  apiProvider: 'openai|anthropic|custom',
  apiKey: 'string',
  customEndpoint: 'string',
  customPrompts: {
    openai: 'custom prompt template',
    anthropic: 'custom prompt template', 
    custom: 'custom prompt template'
  }
}
```

### Default Prompt Templates
[Source: Background script analysis]
Default templates should be defined for each provider:
- OpenAI format: System message + user content structure
- Anthropic format: Human/assistant message structure  
- Custom format: Flexible template with variable substitution

### UI Integration Requirements
[Source: docs/front-end-spec.md#additional-requirements]
- Must follow existing Azure DevOps styling alignment
- Separate settings UI best practices for browser extensions
- Maintain responsive design across different screen sizes
- Ensure accessibility compliance with existing standards

### Project Structure Notes
Files to modify/create:
- `/options/options.html` - Add prompt management UI section
- `/options/options.css` - Extend styling for new components
- `/options/options.js` - Enhance OptionsManager with prompt management
- `/tests/options.test.js` - Extend existing test suite

### Testing
[Source: Previous story testing patterns]
- **Test file location**: `/tests/options.test.js` (extend existing 26 tests)
- **Testing approach**: Unit tests for prompt CRUD operations, UI interactions, storage integration
- **Integration testing**: Full options page flow including prompt customization
- **Manual testing**: Cross-provider prompt editing and preview functionality

## Change Log
| Date       | Version | Description                      | Author |
|------------|---------|----------------------------------|--------|
| 2025-08-01 | 1.0     | Initial story draft              | BMad   |

## Dev Agent Record

### Agent Model Used
*To be populated during implementation*

### Debug Log References
*To be populated during implementation*

### Completion Notes List
*To be populated during implementation*

### File List
*To be populated during implementation*

## QA Results
*Results from QA Agent review will be populated here after story completion*