<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Reviewer Settings</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="options.css">
</head>
<body>
    <div class="container">
        <h1><span class="material-icons">settings</span> Story Reviewer Settings</h1>
        
        <div class="section api-config-section">
            <div class="section-header">
                <h2><span class="material-icons">hub</span> LLM API Configuration</h2>
                <div class="help-toggle" id="apiHelpToggle">
                    <span class="help-icon">?</span>
                    <span class="help-text">Show help</span>
                </div>
            </div>
            
            <div class="contextual-help" id="apiHelp">
                <div class="help-content">
                    <h4><span class="material-icons">vpn_key</span> Getting API Keys:</h4>
                    <div class="help-links">
                        <div class="help-item">
                            <strong>OpenAI:</strong> <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com/api-keys</a>
                        </div>
                        <div class="help-item">
                            <strong>Anthropic:</strong> <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a>
                        </div>
                        <div class="help-item">
                            <strong>Mistral:</strong> <a href="https://console.mistral.ai/" target="_blank">console.mistral.ai</a>
                        </div>
                    </div>
                    <div class="security-note">
                        <span class="material-icons">security</span> <strong>Security:</strong> Your API key is stored securely in your browser and never shared with third parties.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="apiProvider">API Provider:</label>
                <select id="apiProvider">
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                    <option value="mistral">Mistral AI</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="apiKey">API Key:</label>
                <input type="password" id="apiKey" placeholder="Enter your API key">
                <button type="button" id="toggleApiKey" class="toggle-btn">Show</button>
            </div>
            
            <div class="form-group">
                <label for="modelSelect">Model:</label>
                <select id="modelSelect">
                    <option value="">Select a model...</option>
                </select>
                <div class="model-help" id="modelHelp"></div>
            </div>
            
            <div class="form-group">
                <label for="temperature">Temperature:</label>
                <input type="number" id="temperature" min="0" max="2" step="0.1" value="0.7" placeholder="0.7">
                <div class="field-help">Controls randomness: 0.0 = focused, 2.0 = creative (default: 0.7)</div>
            </div>
            
            <div class="form-group">
                <button type="button" id="testConnection" class="test-btn">Test Connection</button>
                <span id="connectionStatus" class="status"></span>
            </div>
        </div>
        
        <div class="section prompts-section">
            <div class="section-header">
                <h2><span class="material-icons">edit_note</span> Custom Prompt Template</h2>
                <div class="section-description">Customize the AI prompt template</div>
            </div>
            
            <div class="prompt-content">
                <div class="form-group">
                    <textarea id="customPrompt" placeholder="Enter your custom prompt template. Use variables like {{formattedContent}} for complete work item details, {{implementationDetails}} for implementation notes, {{storyPoints}} for effort estimation, and many more. See the available variables below." rows="10"></textarea>
                    <div class="character-count">
                        <span id="promptCharCount">0</span> characters
                    </div>
                </div>
                
                <div class="prompt-actions">
                    <button type="button" id="previewPrompt" class="preview-btn">Preview Prompt</button>
                    <button type="button" id="resetPrompt" class="reset-prompt-btn">Reset to Default</button>
                </div>
                
                <div class="prompt-variables">
                    <h4>Available Variables:</h4>
                    <div class="variable-help-text">Click any variable to copy to clipboard</div>
                    
                    <div class="variable-section">
                        <h5>Basic Content</h5>
                        <div class="variable-list">
                            <button type="button" class="variable-tag" data-variable="{{storyContent}}">
                                <span class="variable-name">{{storyContent}}</span>
                                <span class="variable-desc">Original story content</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{formattedContent}}">
                                <span class="variable-name">{{formattedContent}}</span>
                                <span class="variable-desc">Full formatted content</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{title}}">
                                <span class="variable-name">{{title}}</span>
                                <span class="variable-desc">Work item title</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{description}}">
                                <span class="variable-name">{{description}}</span>
                                <span class="variable-desc">Work item description</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{acceptanceCriteria}}">
                                <span class="variable-name">{{acceptanceCriteria}}</span>
                                <span class="variable-desc">Acceptance criteria</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{implementationDetails}}">
                                <span class="variable-name">{{implementationDetails}}</span>
                                <span class="variable-desc">Implementation details</span>
                            </button>
                        </div>
                    </div>

                    <div class="variable-section">
                        <h5>Work Item Properties</h5>
                        <div class="variable-list">
                            <button type="button" class="variable-tag" data-variable="{{workItemId}}">
                                <span class="variable-name">{{workItemId}}</span>
                                <span class="variable-desc">Work item ID</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{workItemType}}">
                                <span class="variable-name">{{workItemType}}</span>
                                <span class="variable-desc">Type (User Story, Bug, etc.)</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{state}}">
                                <span class="variable-name">{{state}}</span>
                                <span class="variable-desc">Current state</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{assignedTo}}">
                                <span class="variable-name">{{assignedTo}}</span>
                                <span class="variable-desc">Assigned to</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{priority}}">
                                <span class="variable-name">{{priority}}</span>
                                <span class="variable-desc">Priority level</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{storyPoints}}">
                                <span class="variable-name">{{storyPoints}}</span>
                                <span class="variable-desc">Story points</span>
                            </button>
                        </div>
                    </div>

                    <div class="variable-section">
                        <h5>Project Organization</h5>
                        <div class="variable-list">
                            <button type="button" class="variable-tag" data-variable="{{areaPath}}">
                                <span class="variable-name">{{areaPath}}</span>
                                <span class="variable-desc">Area path</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{iterationPath}}">
                                <span class="variable-name">{{iterationPath}}</span>
                                <span class="variable-desc">Iteration/Sprint</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{tags}}">
                                <span class="variable-name">{{tags}}</span>
                                <span class="variable-desc">Tags (comma-separated)</span>
                            </button>
                        </div>
                    </div>

                    <div class="variable-section">
                        <h5>Time Tracking</h5>
                        <div class="variable-list">
                            <button type="button" class="variable-tag" data-variable="{{originalEstimate}}">
                                <span class="variable-name">{{originalEstimate}}</span>
                                <span class="variable-desc">Original estimate</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{remainingWork}}">
                                <span class="variable-name">{{remainingWork}}</span>
                                <span class="variable-desc">Remaining work</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{completedWork}}">
                                <span class="variable-name">{{completedWork}}</span>
                                <span class="variable-desc">Completed work</span>
                            </button>
                        </div>
                    </div>

                    <div class="variable-section">
                        <h5>System Information</h5>
                        <div class="variable-list">
                            <button type="button" class="variable-tag" data-variable="{{createdDate}}">
                                <span class="variable-name">{{createdDate}}</span>
                                <span class="variable-desc">Created date</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{modifiedDate}}">
                                <span class="variable-name">{{modifiedDate}}</span>
                                <span class="variable-desc">Last modified date</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{activity}}">
                                <span class="variable-name">{{activity}}</span>
                                <span class="variable-desc">Latest activity</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{timestamp}}">
                                <span class="variable-name">{{timestamp}}</span>
                                <span class="variable-desc">Current time</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{provider}}">
                                <span class="variable-name">{{provider}}</span>
                                <span class="variable-desc">API provider</span>
                            </button>
                            <button type="button" class="variable-tag" data-variable="{{feedbackType}}">
                                <span class="variable-name">{{feedbackType}}</span>
                                <span class="variable-desc">Feedback type</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="import-export-section">
                    <h4>Import/Export Prompts</h4>
                    <div class="import-export-description">Save your custom prompts or restore from backup files</div>
                    <div class="import-export-actions">
                        <button type="button" id="exportPrompts" class="export-btn">Export All Prompts</button>
                        <button type="button" id="importPrompts" class="import-btn">Import Prompts</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </div>
                
                <div id="promptValidation" class="validation-message"></div>
            </div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
    </div>
    
    <!-- Preview Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Prompt Preview</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="preview-content">
                    <h4>Final Prompt:</h4>
                    <div id="previewText" class="preview-text"></div>
                    <button type="button" id="copyPreview" class="copy-btn">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="options.js"></script>
</body>
</html>